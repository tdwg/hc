# Build scripts

## Generating the "list of terms" document for the main eco vocabulary

Prior to building the production List of Terms document, the Python script "update_previous_doc.py" must be run to change the headers of the previous version of the document and to rename that previous version to a dated version. This must be done first, otherwise the previous index.md file will be overwritten by the new one that is generated by the build-termlist.py script. NOTE: The vocabulary and document metadata in the rs.tdwg.org repository must have been updated before running this script. See <https://github.com/tdwg/rs.tdwg.org/blob/master/process/process-vocabulary.md> for details. Command line arguments are:

`--slug` (required): the last part of the document URL before the trailing slash. For the Humboldt Extension List of Terms, this is `eco`.

`--dir` (required): the subdirectory of the `process/document_metadata_processing/` directory in the rs.tdwg.org repository where the `author_metadata.yaml` and `document_metadata.yaml` files are located. For the Humboldt Extension List of Terms, this is `dwc_doc_eco`.

`--branch` (optional): the branch of the rs.tdwg.org repository where the metadata are located. The default is `master`.

If you are creating a List of Terms document for proofreading prior to ratification, then you should first create a branch of the repo so that the previous version of the document in master is not overwritten and so that the preliminary draft does not appear in the GitHub pages site. You can then run the build-termlist.py script to generate a new index.md file and commit it to the branch. You can then look at the document in the GitHub repository (not the eco.tdwg.org GitHub pages site) to see how it is rendered. It will not have the styling that is provided by the TDWG Jekyll theme.

The Python script `build-termlist.py` inputs the header information from `termlist-header.md`, then builds the list of terms and their metadata from data in the [rs.tdwg.org](http://github.com/tdwg/rs.tdwg.org) repository. The script also inputs `termlist-footer.md` and appends it to the end of the generated document, but currently it has no content. After the header, term list, and footer are concatenated, the script will then insert author and document metadata from the `author_metadata.yaml` and `document_metadata.yaml` files from the rs.tdwg.org GitHub repository. Therefore, those files must be in place and updated prior to running the script. The constructed Markdown document is saved as `/docs/list/index.md`. 

Command line arguments are:

`--branch` (optional): the branch of the rs.tdwg.org repository where the metadata are located. The default is `master`.

## Generating the additional standards documents from their templates

The script `build_other_doc_header.py` inserts document and author metadata from the rs.tdwg.org repo (as with the List of Terms document) and inserts them into the header of the document template that is stored in a subdirectory whose name parallels the permanent IRI of the document (e.g. for `http://rs.tdwg.org/dwc/doc/hierarchy/`, the directory is `dwc_doc_hierarchy`). ([example document template](https://github.com/tdwg/hc/blob/main/build/dwc_doc_hierarchy/index.md)). Unlike the List of Terms document, the document template is largely hand-edited (except for the header). If the document content is to be updated, it must be edited in the template file, with the production doc regenerated by this script.

Command line options are:

`--slug` (required): the last part of the document URL before the trailing slash. For example, the slug for `http://rs.tdwg.org/dwc/doc/hierarchy/` is `hierarchy`. 

`--branch` (optional): the branch of the rs.tdwg.org repository where the metadata are located. The default is `master`.

Once the production document is generated in the `docs` directory, check the diff of the production document to make sure it makes sense. ([example production doc](https://github.com/tdwg/hc/blob/main/docs/hierarchy/index.md)) push the change to GitHub. If the main branch is being used, it will take some time for GitHub Pages to rebuild the site. When that is done, the TDWG styling will be applied to the production page.

## Generating the "normative document" (term versions CSV file)

The script `generate_term_versions.py` pulls source data from the [rs.tdwg.org](http://github.com/tdwg/rs.tdwg.org) repository. The local file `qrg-list.csv` contains a list of the term IRIs in the order that they are to appear in the Quick Reference Guide. This list needs to be changed whenever terms are added to or deprecated from Darwin Core.

It generates the file `term_versions.csv`, which is used as the input for the `build.py` script below.

## Build script for the eco Quick Reference Guide

The build script `build.py` uses as input:

* [vocabulary/term_versions.csv](../vocabulary/term_versions.csv): the list of terms
* [terms.tmpl](terms.tmpl): a Jinja2 template for the quick reference guide

And creates:

* The quick reference guide is a Markdown file at [docs/terms/index.md](../docs/terms/index.md). The guide is built as Markdown (with a lot of included html) rather than html, so it can be incorporated by Jekyll in the Darwin Core website (including a header, footer and table of contents).
* Two simple Darwin Core CSV files in [dist/](../dist/)

**Run the build script**

1. Install the required libraries (once):

    ```bash
    pip install -r requirements.txt
    ```

2. Run the script from the command line:

    ```bash
    python build.py
    ```

